function login_model(e,t){var r=e.login={mobile:"13612345678",password:"123456"},i=publicAjaxUrl+"Mobile/Driver/";e.submit=function(){$.ajax({url:i+"login.html",type:"post",data:{mobile:r.mobile,password:r.password},error:function(e){alert("无法访问服务器")},success:function(e){var e=JSON.parse(e);window.localStorage?(localStorage.setItem("userid",e.id),localStorage.setItem("username",e.username),localStorage.setItem("userphone",e.mobile),localStorage.setItem("usercity",e.city),window.location.href="#/me/index",getOrderCount()):alert("不支持本地存储")}})}}function getJsonLength(e){var t=0;for(var r in e)t++;return t}function getOrderCount(){var e=publicAjaxUrl+"index.php?m=Mobile&c=Driver&a=waitSend";$.ajax({url:e,type:"get",data:{id:userid},success:function(e){startNumber=getJsonLength(JSON.parse(e))}});var t=publicAjaxUrl+"index.php?m=Mobile&c=Driver&a=onSend";$.ajax({url:t,type:"get",data:{id:userid},success:function(e){onSendNumber=getJsonLength(JSON.parse(e))}});var r=publicAjaxUrl+"index.php?m=Mobile&c=Driver&a=completeSend";return $.ajax({url:r,type:"get",data:{id:userid},success:function(e){completeNumber=getJsonLength(JSON.parse(e))}}),getOrderCount}function loadingModel(){$(document).on("ajaxStart",function(e){$.showPreloader()}).on("ajaxStop",function(e){$.hidePreloader()})}function status_index_model(e,t){loadingModel(),getOrderCount(),e.startnum=startNumber,e.deliverynum=onSendNumber,e.completenum=completeNumber;var r=publicAjaxUrl+"index.php?m=Mobile&c=Driver&a=waitSend";t.get(r,myData).success(function(t){e.statusList=t}),e.view_order_detail=function(){startOrderId=this.list.id},e.start_delivery=function(){startOrderId=this.list.id,$.modal({title:"请选择预约到达时间",text:'<div class="selectTime"><select><option selected value="12:00">上午</option><option value="18:00">下午</option><option value="23:00">晚上</option></select></div>',buttons:[{text:"取消",bold:!0},{text:"确定",bold:!0,onClick:function(){var e=$("option").not(function(){return!this.selected}).val(),r={params:{dispatch_id:startOrderId,selected:e,driver_id:userid}},i=publicAjaxUrl+"index.php?m=Mobile&c=Driver&a=startDispatch";t.get(i,r).success(function(e){"y"==e.status?($.toast("操作成功"),window.location.href="#/driver/delivery"):"n"==e.status&&$.toast("操作失败")})}}]})}}function status_delivery_model(e,t){loadingModel(),getOrderCount(),e.startnum=startNumber,e.deliverynum=onSendNumber,e.completenum=completeNumber;var r=publicAjaxUrl+"index.php?m=Mobile&c=Driver&a=onSend";t.get(r,myData).success(function(t){e.statusList=t}),e.view_order_detail=function(){startOrderId=this.list.id},e.editCarryPay=function(e){var r=this;$.prompt("请输入金额(元)","建议修改搬运费",function(e){var i={params:{dispatch_id:r.list.id,money:e,driver_id:userid}},o=publicAjaxUrl+"index.php?m=Mobile&c=Driver&a=deliveryFee";t.get(o,i).success(function(t){1==t.success?($.alert("搬运费修改为"+e+"元,等用户确认后生效"),r.list.carryRecord={status:0}):0==t.success&&$.alert("搬运费输入错误或者不能为空")})})},e.confirmtake=function(){var e=this,r={params:{dispatch_id:e.list.id,driver_id:userid}},i=publicAjaxUrl+"index.php?m=Mobile&c=Driver&a=customerSign";t.get(i,r).success(function(e){"y"==e.status?($.toast("签收成功"),window.location.href="#/driver/complete"):"n"==e.status&&$.toast(e.info)})}}function status_complete_model(e,t){function r(){var r=publicAjaxUrl+"index.php?m=Mobile&c=Driver&a=completeSend";t.get(r,myData).success(function(t){e.statusList=t})}loadingModel(),getOrderCount(),e.startnum=startNumber,e.deliverynum=onSendNumber,e.completenum=completeNumber,r(),e.view_order_detail=function(){startOrderId=this.list.id},e.uploadImg=function(e){function r(){plus.gallery.pick(function(e){var r=publicAjaxUrl+"Mobile/Driver/uploadFile.html?dispatch_id="+i.statusList.id+"&driver_id="+userid;$.showPreloader("开始上传");var o=plus.uploader.createUpload(r,{method:"POST"},function(e,r){if(200==r){$.hidePreloader();var o=JSON.parse(e.responseText).files.ybgimg,a=o.success;if(1==a){$.toast("上传成功");var s=publicAjaxUrl+"index.php?m=Mobile&c=Driver&a=downphotograph",n={params:{dispatch_id:i.list.id,driver_id:userid,site_info_id:i.list.order.site_info_id,media_id:o.url}};t.get(s,n).success(function(e){1==e.success||$.toast("发生错误了，请联系云包猿")})}else $.toast("上传失败")}else $.hidePreloader(),$.alert("上传失败："+r)});o.addFile(e,{key:"ybgimg"}),o.start()},function(e){},{filter:"image"})}var i=this;r()},e.viewImgFun=function(e){function t(e,t){var r=$.photoBrowser({photos:e,type:"popup",theme:"light",type:"standalone"});r.open(t),$(".photo-browser .bar-nav").append("<a class='icon icon-remove pull-right' ng-click='del($index)'></a>"),$(".icon-remove").click(function(){i.splice(t,1),$.confirm("你确认要删除吗?",function(){var e=$(".photo-browser-current").text()-1,t=i[e].id;$.post(publicAjaxUrl+"mobile/driver/delimage",{image_id:t},function(t){"1"==t.status?$(".img-brower-list li").eq(e).remove():$.alert("0"==t.status?"失败了，请联系云包猿":"未知错误")}),$(".photo-browser").remove()})})}var r=this,i=r.list.dispatch_image,o=[];for(var a in i)o.push(i[a].image_path);t(o,e)}}function status_detail_model(e,t){var r={params:{dispatch_id:startOrderId,driver_id:userid}},i=publicAjaxUrl+"/index.php?m=Mobile&c=Driver&a=dispatchDetail";t.get(i,r).success(function(t){e.detailList=t}),e.start_delivery=function(){$.modal({title:"请选择预约到达时间",text:'<div class="selectTime"><select><option selected value="12:00">上午</option><option value="18:00">下午</option><option value="23:00">晚上</option></select></div>',buttons:[{text:"取消",bold:!0},{text:"确定",bold:!0,onClick:function(){var e=$("option").not(function(){return!this.selected}).val(),r={params:{dispatch_id:startOrderId,selected:e,driver_id:userid}},i=publicAjaxUrl+"index.php?m=Mobile&c=Driver&a=startDispatch";t.get(i,r).success(function(e){"y"==e.status?($.toast("操作成功"),window.location.href="#/driver/delivery"):"n"==e.status&&$.toast("操作失败")})}}]})},e.confirmtake=function(){var e=this,r={params:{dispatch_id:startOrderId,driver_id:userid}},i=publicAjaxUrl+"index.php?m=Mobile&c=Driver&a=customerSign";t.get(i,r).success(function(e){alert(JSON.stringify(e)),"y"==e.status?($.toast("签收成功"),window.location.href="#/driver/complete"):"n"==e.status&&$.toast(e.info)})}}function driver_me_model(e,t){function r(){var e=plus.push.getClientInfo();$.alert("获取客户端推送标识信息："),$.alert("token: "+e.token),$.alert("clientid: "+e.clientid),$.alert("appid: "+e.appid),$.alert("appkey: "+e.appkey)}function i(){var e={cover:!1},t=new Date;t+=": 欢迎使用Html5 Plus创建本地消息！",plus.push.createMessage(t,"LocalMSG",e),$.alert("创建本地消息成功！"),$.alert("请到系统消息中心查看！"),"iOS"==plus.os.name&&$.alert('*如果无法创建消息，请到"设置"->"通知"中配置应用在通知中心显示!')}e.me={name:userName,tel:userPhone};var o="http://demo.dcloud.net.cn/helloh5/push/",a=null;document.addEventListener("plusready",function(){a=document.getElementById("message"),plus.push.addEventListener("click",function(e){switch(e.payload){case"LocalMSG":outSet("点击本地创建消息启动：");break;default:outSet("点击离线推送消息启动：")}plus.ui.alert(e.content),logoutPushMsg(e)},!1),plus.push.addEventListener("receive",function(e){outSet(e.aps?"接收到在线APNS消息：":"接收到在线透传消息："),logoutPushMsg(e)},!1)},!1),e.getPush=function(){r()},e.createLocalPush=function(){i()}}var publicAjaxUrl="http://debug.yunbaogong.cn/",ybgapp=angular.module("ybg-app",["ngRoute"]);ybgapp.config(["$routeProvider",function(e){e.otherwise({redirectTo:"/login"}).when("/login",{templateUrl:"login.html",controller:login_model}).when("/driver/start",{templateUrl:"driver_index_status_start.html",controller:status_index_model}).when("/driver/delivery",{templateUrl:"driver_index_status_delivery.html",controller:status_delivery_model}).when("/driver/complete",{templateUrl:"driver_index_status_complete.html",controller:status_complete_model}).when("/driver/detail",{templateUrl:"driver_order_more.html",controller:status_detail_model}).when("/me/index",{templateUrl:"driver_me_index.html",controller:driver_me_model})}]);var userid=localStorage.getItem("userid"),userName=localStorage.getItem("username"),userPhone=localStorage.getItem("userphone"),userCity=localStorage.getItem("usercity"),startOrderId,myData={params:{id:userid}},startNumber,onSendNumber,completeNumber;